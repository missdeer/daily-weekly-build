#!/bin/sh
set -e

OPTS="--prefix=$SCRATCH/$ARCH \
	--exec-prefix=$SCRATCH/$ARCH \
	--disable-cplayer \
	--disable-lcms2 \
	--disable-lua \
	--disable-rubberband \
	--disable-zimg \
	--enable-libmpv-static \
	--enable-ios-gl \
	--enable-gl \
	--disable-javascript \
	--disable-libbluray \
	--disable-vapoursynth \
	--enable-uchardet \
	--enable-lgpl"

if [[ "$ENVIRONMENT" = "development" ]]; then
	OPTS="$OPTS --disable-optimize"
fi

cd $SRC/mpv*
curl -L https://raw.githubusercontent.com/missdeer/daily-weekly-build/master/ios/wscript_build.py -o wscript_build.py
curl -L https://raw.githubusercontent.com/missdeer/daily-weekly-build/master/ios/wscript -o wscript
./bootstrap.py
./waf configure $OPTS
./waf build -j `sysctl -n hw.logicalcpu`
